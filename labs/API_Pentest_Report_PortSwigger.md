# BÁO CÁO ĐÁNH GIÁ BẢO MẬT ỨNG DỤNG (SECURITY ASSESSMENT REPORT)

**Dự án:** PortSwigger API Security Labs

| Thông tin dự án | Chi tiết |
| :--- | :--- |
| **Mục tiêu đánh giá** | Module API Testing - PortSwigger Web Security Academy |
| **Người thực hiện** | Mai Hải Đăng |
| **Ngày thực hiện** | 29/01/2026 |
| **Phiên bản báo cáo** | v1.1 (Cập nhật Ma trận Mapping) |
| **Trạng thái** | Hoàn thành |

## 1. TÓM TẮT QUẢN TRỊ (EXECUTIVE SUMMARY)

### 1.1. Tổng quan

Báo cáo này trình bày kết quả kiểm thử xâm nhập (Penetration Testing) được thực hiện trên các ứng dụng mẫu thuộc module API Testing của PortSwigger. Mục tiêu của đợt kiểm thử là xác định các lỗ hổng bảo mật trong việc thiết kế và triển khai API, từ đó đưa ra các khuyến nghị khắc phục nhằm nâng cao tính an toàn cho hệ thống.

### 1.2. Kết quả chính

Trong quá trình đánh giá, tôi đã phát hiện **05** lỗ hổng bảo mật, trong đó có **02** lỗ hổng Nghiêm trọng (Critical) và **02** lỗ hổng Cao (High). Các vấn đề chủ yếu tập trung vào:

*   Thiếu kiểm soát truy cập vào các endpoint nhạy cảm (Broken Access Control).
*   Xử lý dữ liệu đầu vào không an toàn dẫn đến ô nhiễm tham số (Parameter Pollution).
*   Cấu hình mặc định không an toàn (Security Misconfiguration).

---

## 2. CHI TIẾT CÁC LỖ HỔNG (VULNERABILITY FINDINGS)

### FINDING-01: Lộ thông tin nhạy cảm qua tài liệu API công khai

*   **Mức độ:** Trung bình (Medium)
*   **CVSS v3.1:** 5.3 (AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)
*   **Tham chiếu WSTG:** WSTG-INFO-05

**Mô tả:**

Hệ thống để lộ tệp tin tài liệu kỹ thuật API (thường là Swagger/OpenAPI) tại đường dẫn mặc định mà không yêu cầu xác thực. Việc này cho phép kẻ tấn công nắm rõ cấu trúc hạ tầng API, các phương thức (HTTP Methods) và tham số, từ đó tìm ra các bề mặt tấn công tiềm ẩn.

**Bằng chứng khai thác (Proof of Concept):**

1.  Truy cập đường dẫn `/api-docs`.
2.  Hệ thống trả về cấu trúc JSON mô tả toàn bộ API.
3.  Phát hiện endpoint nhạy cảm `DELETE /api/user/{username}` được mô tả trong tài liệu nhưng không hiển thị trên giao diện người dùng.
4.  Kẻ tấn công gửi request xóa người dùng `carlos`:

```http
DELETE /api/user/carlos HTTP/1.1
Host: target-lab.net
```

**Tác động:**

Kẻ tấn công có thể xóa tài khoản người dùng hoặc thực hiện các hành động quản trị mà không cần đoán đường dẫn.

**Khuyến nghị:**

*   Vô hiệu hóa truy cập công khai vào các đường dẫn tài liệu API (`/api-docs`, `/swagger-ui`) trên môi trường Production.
*   Yêu cầu xác thực mạnh cho tất cả các endpoint thay đổi dữ liệu (POST, PUT, DELETE).

### FINDING-02: Ô nhiễm tham số phía Server (Query String) dẫn đến chiếm quyền tài khoản

*   **Mức độ:** Cao (High)
*   **CVSS v3.1:** 8.1 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N)
*   **Tham chiếu WSTG:** WSTG-INPV-04

**Mô tả:**

Lỗ hổng Server-Side Parameter Pollution (SSPP) xảy ra khi ứng dụng backend ghép trực tiếp input của người dùng vào một request nội bộ (internal request) mà không mã hóa (encoding) các ký tự đặc biệt. Kẻ tấn công có thể tiêm nhiễm các ký tự phân tách tham số (như `&` hoặc `#`) để ghi đè hoặc thêm tham số mới vào request nội bộ.

**Bằng chứng khai thác (Proof of Concept):**

1.  Chức năng "Quên mật khẩu" gửi request đến API nội bộ.
2.  Kẻ tấn công nhập username có chứa ký tự mã hóa URL: `administrator%26field=reset_token`.
3.  Request nội bộ bị biến đổi thành:

```http
POST /internal/api/email?username=administrator&field=reset_token
```

4.  Thay vì gửi email, server trả về `reset_token` của quản trị viên `administrator` ngay trong phản hồi HTTP.

**Tác động:**

Cho phép kẻ tấn công chiếm đoạt tài khoản quản trị viên (Account Takeover) mà không cần truy cập vào email của nạn nhân.

**Khuyến nghị:**

*   Sử dụng hàm mã hóa URL (URL Encoding) chuẩn cho mọi dữ liệu đầu vào trước khi đưa vào chuỗi query string.
*   Sử dụng các thư viện HTTP Client an toàn hỗ trợ tham số hóa thay vì nối chuỗi thủ công.

### FINDING-03: Bỏ qua kiểm soát truy cập thông qua Endpoint không sử dụng (Shadow API)

*   **Mức độ:** Cao (High)
*   **CVSS v3.1:** 7.5 (AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N)
*   **Tham chiếu WSTG:** WSTG-CONF-04, WSTG-ATHZ-02

**Mô tả:**

Nhà phát triển đã không loại bỏ triệt để các API endpoint cũ hoặc không còn sử dụng (Shadow APIs). Các endpoint này thường không được bảo trì và thiếu các lớp bảo mật mới nhất, cho phép kẻ tấn công thực hiện các hành động trái phép.

**Bằng chứng khai thác (Proof of Concept):**

1.  Phát hiện endpoint ẩn `/api/products/{id}/price` thông qua phân tích file JavaScript phía client (`main.js`).
2.  Tài liệu chỉ cho phép `GET`, nhưng endpoint này vẫn chấp nhận phương thức `PATCH`.
3.  Gửi request thay đổi giá sản phẩm:

```http
PATCH /api/products/1/price HTTP/1.1
Content-Type: application/json

{"price": 0}
```

4.  Sản phẩm được cập nhật giá về 0đ.

**Tác động:**

Gây thiệt hại tài chính trực tiếp cho doanh nghiệp thông qua việc mua hàng miễn phí hoặc giảm giá trái phép.

**Khuyến nghị:**

*   Rà soát định kỳ và loại bỏ (De-provisioning) các API endpoint không còn sử dụng.
*   Cấu hình Web Server hoặc API Gateway để chỉ chấp nhận các phương thức HTTP (Verb) được cho phép (Whitelist methods).

### FINDING-04: Leo thang đặc quyền thông qua lỗi Gán giá trị hàng loạt (Mass Assignment)

*   **Mức độ:** Nghiêm trọng (Critical)
*   **CVSS v3.1:** 9.1 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
*   **Tham chiếu WSTG:** WSTG-ATHZ-03

**Mô tả:**

Ứng dụng tự động liên kết (binding) tất cả dữ liệu JSON đầu vào vào các đối tượng (Object) trong mã nguồn mà không có danh sách cho phép (Whitelist). Kẻ tấn công có thể đoán và thêm các trường nhạy cảm (như `role`, `isAdmin`, `discount`) vào payload để thay đổi trạng thái đối tượng.

**Bằng chứng khai thác (Proof of Concept):**

1.  Trong quy trình thanh toán, quan sát thấy object `chosen_discount` trong phản hồi JSON:

```json
"chosen_discount": { "percentage": 0 }
```

2.  Gửi lại request `POST /api/checkout` và tự ý thêm trường này vào Body:

```json
{
    "product_id": 1,
    "chosen_discount": { "percentage": 100 }
}
```

3.  Server chấp nhận xử lý và đơn hàng được miễn phí 100%.

**Tác động:**

Kẻ tấn công có thể mua hàng miễn phí hoặc tự thăng cấp quyền hạn lên Admin (nếu tấn công vào endpoint cập nhật profile), gây rủi ro nghiêm trọng về tài chính và bảo mật hệ thống.

**Khuyến nghị:**

*   Tránh sử dụng tính năng tự động binding input vào Model của framework.
*   Sử dụng mô hình DTO (Data Transfer Object) để định nghĩa chính xác những trường dữ liệu nào được phép nhận từ người dùng.

### FINDING-05: Ô nhiễm tham số phía Server trong REST URL (Path Traversal)

*   **Mức độ:** Nghiêm trọng (Expert/Critical)
*   **CVSS v3.1:** 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
*   **Tham chiếu WSTG:** WSTG-INPV-04, WSTG-ATHZ-01

**Mô tả:**

Đây là một biến thể phức tạp của lỗi Parameter Pollution. Ứng dụng backend ghép tham số người dùng vào đường dẫn URL (Path) của một API nội bộ. Do thiếu kiểm tra ký tự đặc biệt, kẻ tấn công có thể sử dụng kỹ thuật Path Traversal (`../`) để thoát khỏi đường dẫn dự kiến và gọi đến bất kỳ API nội bộ nào khác.

**Bằng chứng khai thác (Proof of Concept):**

1.  Xác định endpoint: `/api/internal/{username}/profile`.
2.  Mục tiêu: Gọi API xóa user của Admin tại `/admin/delete?username=carlos`.
3.  Kẻ tấn công nhập payload Path Traversal vào vị trí `{username}`:

```text
../../admin/delete?username=carlos
```

4.  URL nội bộ được backend xây dựng thành:

```text
/api/internal/../../admin/delete?username=carlos/profile
```
(Do cơ chế chuẩn hóa URL, `../../` sẽ đưa request về thư mục gốc và gọi `/admin/delete`)

**Tác động:**

Cho phép truy cập trái phép vào các chức năng quản trị hệ thống (Admin Panel) mà thông thường bị chặn bởi tường lửa hoặc phân quyền, dẫn đến chiếm quyền kiểm soát hệ thống.

**Khuyến nghị:**

*   Kiểm tra nghiêm ngặt dữ liệu đầu vào, tuyệt đối cấm các ký tự thay đổi cấu trúc đường dẫn như `/`, `\`, ...
*   Sử dụng cơ chế whitelist cho các giá trị tham số được phép truyền vào URL.

---

## 3. MA TRẬN ĐỐI CHIẾU PHƯƠNG PHÁP LUẬN (METHODOLOGY MAPPING MATRIX)

Bảng dưới đây giải thích sự liên kết giữa các lỗ hổng phát hiện được và bộ tiêu chuẩn OWASP WSTG v4.2 được áp dụng:

| Lỗ hổng (Finding) | Mã WSTG | Tên kỹ thuật trong WSTG | Lý giải & Áp dụng từ tài liệu |
| :--- | :--- | :--- | :--- |
| **01. API Docs Exposure** | WSTG-INFO-05 | Review Webpage Content for Information Leakage | Theo tài liệu **1-WSTG-INFO**, mục tiêu của kỹ thuật này là "Rà soát mã nguồn phía Client... để tìm thông tin bị bỏ quên". API Documentation chứa toàn bộ cấu trúc endpoint, tương tự như việc lộ source code hoặc file map, giúp hacker định hình bề mặt tấn công. |
| **02. SSPP (Query String)** | WSTG-INPV-04 | HTTP Parameter Pollution | Theo tài liệu **7-WSTG-INPV**, kỹ thuật này kiểm tra "Gửi cùng một tham số nhiều lần để xem ứng dụng xử lý thế nào". Ở đây, việc chèn thêm tham số vào request nội bộ là một biến thể nâng cao của lỗi này nhằm bypass logic backend. |
| **03. Unused API Endpoint** | WSTG-CONF-04 | Review Old Backup and Unreferenced Files | Theo tài liệu **2-WSTG-CONF**, mục tiêu là "Tìm các file 'mồ côi' (không được liên kết)... nhưng vẫn tồn tại trên server". API endpoint ẩn/cũ chính là các tài nguyên "mồ côi" này, thường chứa lỗ hổng do thiếu bảo trì. |
| **03. Unused API Endpoint** | WSTG-ATHZ-02 | Bypassing Authorization Schema | Theo tài liệu **5-WSTG-ATHZ**, kỹ thuật này bao gồm "Forced Browsing" (truy cập thẳng URL ẩn) để thực hiện hành động trái phép (ví dụ: đổi giá sản phẩm) mà không qua giao diện người dùng chính thức. |
| **04. Mass Assignment** | WSTG-ATHZ-03 | Privilege Escalation | Theo tài liệu **5-WSTG-ATHZ**, kỹ thuật leo thang đặc quyền bao gồm việc "Thử thay đổi tham số role=user thành role=admin". Lỗi Mass Assignment cho phép thực hiện chính xác điều này bằng cách tiêm nhiễm các trường JSON nhạy cảm vào request. |
| **05. SSPP (REST URL)** | WSTG-ATHZ-01 | Directory Traversal | Theo tài liệu **5-WSTG-ATHZ**, kỹ thuật này kiểm tra việc "ứng dụng nhận input người dùng và ghép vào đường dẫn hệ thống". Trong trường hợp này, input `../` được ghép vào URL path của backend để truy cập API trái phép. |

## 4. KẾT LUẬN

Kết quả kiểm thử cho thấy hệ thống API đang tồn tại các lỗ hổng nghiêm trọng liên quan đến việc xử lý dữ liệu đầu vào và kiểm soát truy cập. Mặc dù ứng dụng có các cơ chế bảo vệ cơ bản, nhưng việc thiếu validation ở các tầng sâu (backend internal requests) đã tạo điều kiện cho các cuộc tấn công phức tạp.

Đội ngũ phát triển cần ưu tiên khắc phục các lỗ hổng **Mass Assignment** và **Parameter Pollution** ngay lập tức, đồng thời rà soát lại toàn bộ tài liệu và endpoint API không sử dụng.